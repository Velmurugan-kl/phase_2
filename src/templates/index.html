<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LungAI ‚Äî Upload X-Ray</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    .upload-card {
      max-width: 640px;
      margin: 0 auto;
    }

    .upload-preview {
      display: none;
      margin-top: 24px;
      padding: 16px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--navy-border);
      border-radius: var(--radius);
      align-items: center;
      gap: 14px;
    }

    .upload-preview.show { display: flex; }

    .preview-thumb {
      width: 64px; height: 64px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid var(--navy-border);
      flex-shrink: 0;
    }

    .preview-name {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--white);
    }

    .preview-size {
      font-size: 0.775rem;
      font-family: var(--font-mono);
      color: var(--muted);
      margin-top: 2px;
    }

    .error-msg {
      display: none;
      color: #f87171;
      font-size: 0.8rem;
      margin-top: 10px;
      align-items: center;
      gap: 6px;
    }

    .error-msg.show { display: flex; }

    .info-strip {
      display: flex;
      gap: 24px;
      margin-top: 40px;
      padding-top: 32px;
      border-top: 1px solid var(--navy-border);
    }

    .info-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      flex: 1;
    }

    .info-item-icon {
      width: 36px; height: 36px;
      border-radius: 9px;
      background: rgba(13,148,136,0.1);
      border: 1px solid var(--teal-border);
      display: flex; align-items: center; justify-content: center;
      color: var(--teal-light);
      font-size: 14px;
      flex-shrink: 0;
    }

    .info-item h5 {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--white);
      margin-bottom: 3px;
    }

    .info-item p {
      font-size: 0.75rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .model-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.73rem;
      font-family: var(--font-mono);
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--navy-border);
      color: var(--muted-light);
    }

    .model-pill .dot { width: 6px; height: 6px; border-radius: 50%; }
  </style>
</head>
<body>

<!-- Header -->
<header class="site-header">
  <div class="header-inner">
    <a href="/" class="header-brand" style="text-decoration:none;">
      <div class="brand-icon">ü´Å</div>
      <div>
        <div class="brand-name">LungAI</div>
        <div class="brand-sub">Diagnostic System v2.0</div>
      </div>
    </a>
    <nav class="header-nav">
      <a href="/" class="nav-link active"><i class="fas fa-upload"></i> Upload</a>
      <a href="/dashboard" class="nav-link"><i class="fas fa-chart-line"></i> Dashboard</a>
      <a href="/training_queue" class="nav-link"><i class="fas fa-layer-group"></i> Training Queue</a>
    </nav>
  </div>
</header>

<div class="page-wrapper">

  <!-- Page Title -->
  <div class="page-title-block animate-fade-up" style="text-align:center; margin-bottom:40px;">
    <h1>X-Ray Analysis</h1>
    <p>Upload a chest X-ray to classify lung condition using our ensemble model</p>
  </div>

  <!-- Model Pills -->
  <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-bottom:36px;" class="animate-fade-up delay-1">
    <span class="model-pill"><span class="dot" style="background:#f59e0b;"></span> YOLOv8 30%</span>
    <span class="model-pill"><span class="dot" style="background:#14b8a6;"></span> ResNet18 50%</span>
    <span class="model-pill"><span class="dot" style="background:#818cf8;"></span> ViT 5%</span>
    <span class="model-pill"><span class="dot" style="background:#34d399;"></span> CNN 15%</span>
  </div>

  <!-- Upload Card -->
  <div class="card upload-card animate-fade-up delay-2">
    <div class="card-header">
      <i class="fas fa-file-medical text-teal"></i>
      <h3>Upload Chest X-Ray</h3>
    </div>
    <div class="card-body">
      <form action="/result" method="POST" enctype="multipart/form-data" id="uploadForm">

        <div class="upload-zone" id="uploadZone">
          <input type="file" name="file" id="fileInput" accept=".png,.jpg,.jpeg"/>
          <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
          <h3>Drop your X-ray here</h3>
          <p>or click to browse files</p>
          <div class="file-types">
            <span class="badge badge-slate">PNG</span>
            <span class="badge badge-slate">JPG</span>
            <span class="badge badge-slate">JPEG</span>
          </div>
        </div>

        <!-- Preview -->
        <div class="upload-preview" id="previewWrap">
          <img src="" alt="preview" class="preview-thumb" id="previewImg"/>
          <div>
            <div class="preview-name" id="previewName">‚Äî</div>
            <div class="preview-size" id="previewSize">‚Äî</div>
          </div>
          <div style="margin-left:auto;">
            <span class="badge badge-green"><i class="fas fa-check"></i> Ready</span>
          </div>
        </div>

        <!-- Error -->
        <div class="error-msg" id="errorMsg">
          <i class="fas fa-exclamation-circle"></i>
          <span id="errorText">Invalid file format. Only PNG, JPG or JPEG files are allowed.</span>
        </div>

        <div style="margin-top:24px;">
          <button type="submit" class="btn btn-primary btn-lg" style="width:100%; justify-content:center;" id="submitBtn" disabled>
            <i class="fas fa-microscope"></i> Analyse X-Ray
          </button>
        </div>
      </form>

      <!-- Info Strip -->
      <div class="info-strip">
        <div class="info-item">
          <div class="info-item-icon"><i class="fas fa-shield-alt"></i></div>
          <div>
            <h5>5 Disease Classes</h5>
            <p>Bacterial & Viral Pneumonia, COVID-19, Tuberculosis, Normal</p>
          </div>
        </div>
        <div class="info-item">
          <div class="info-item-icon"><i class="fas fa-user-md"></i></div>
          <div>
            <h5>Doctor Review</h5>
            <p>Every prediction can be validated and corrected by clinicians</p>
          </div>
        </div>
        <div class="info-item">
          <div class="info-item-icon"><i class="fas fa-sync-alt"></i></div>
          <div>
            <h5>Continuous Learning</h5>
            <p>Corrections feed back into model retraining automatically</p>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  const fileInput   = document.getElementById('fileInput');
  const uploadZone  = document.getElementById('uploadZone');
  const previewWrap = document.getElementById('previewWrap');
  const previewImg  = document.getElementById('previewImg');
  const previewName = document.getElementById('previewName');
  const previewSize = document.getElementById('previewSize');
  const errorMsg    = document.getElementById('errorMsg');
  const submitBtn   = document.getElementById('submitBtn');
  const allowed     = /\.(png|jpg|jpeg)$/i;

  function formatBytes(b) {
    return b < 1024*1024 ? (b/1024).toFixed(1)+' KB' : (b/1024/1024).toFixed(1)+' MB';
  }

  fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    errorMsg.classList.remove('show');
    previewWrap.classList.remove('show');
    submitBtn.disabled = true;

    if (!file) return;

    if (!allowed.test(file.name)) {
      errorMsg.classList.add('show');
      return;
    }

    const reader = new FileReader();
    reader.onload = e => {
      previewImg.src = e.target.result;
      previewName.textContent = file.name;
      previewSize.textContent = formatBytes(file.size);
      previewWrap.classList.add('show');
      submitBtn.disabled = false;
    };
    reader.readAsDataURL(file);
  });

  // Drag and drop
  uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
  uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
  uploadZone.addEventListener('drop', e => {
    e.preventDefault();
    uploadZone.classList.remove('dragover');
    if (e.dataTransfer.files.length) {
      fileInput.files = e.dataTransfer.files;
      fileInput.dispatchEvent(new Event('change'));
    }
  });
</script>
</body>
</html>